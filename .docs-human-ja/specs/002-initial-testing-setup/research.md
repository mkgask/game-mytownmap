# リサーチ: 初期テスト実装

**日付**: 2026-01-31
**機能**: [specs/002-initial-testing-setup/spec.md](specs/002-initial-testing-setup/spec.md)

## リサーチタスク

### テストフレームワークの選択
**タスク**: TypeScript/Astroプロジェクト with PixiJSでのテストフレームワークのベストプラクティスをリサーチ

**決定**: ユニットおよび統合テストにbun test、E2EテストにPlaywrightを使用
**根拠**: 
- Constitutionでbunをunit testsに指定
- bunはPixiJS/bitECSテストのための優れたTypeScriptサポートとモッキング機能を提供
- Playwrightは開発環境でのE2Eテストのための堅牢なブラウザ自動化を提供
- 両方のフレームワークがAstroと統合し、test-first開発アプローチをサポート

**検討した代替案**:
- Jest: 人気だがconstitutionで指定されておらず、追加依存が必要
- Vitest: 実行が速いが、エコシステムが成熟しておらず、既存ツールとの統合が少ない
- Cypress: E2Eは良いが、Playwrightの方がローカルdevテストでより良いパフォーマンスと柔軟性を提供

### エラーバウンダリの実装
**タスク**: Astro/Reactコンポーネントのエラーバウンダリパターンをリサーチ

**決定**: Astroと互換性のあるReact Error Boundaryコンポーネントを実装
**根拠**: 
- AstroはReactコンポーネントをサポートし、標準的なReactエラーバウンダリを許可
- アプリケーション全体のクラッシュなしで優雅なエラーハンドリングを提供
- コンポーネントベースのアーキテクチャでのエラーバウンダリ要件に従う

**検討した代替案**:
- Astroの組み込みエラーハンドリング: コンポーネントレベルのエラー分離で柔軟性が低い
- グローバルエラーハンドラー: ユーザー体験のためのUIフォールバックを提供しない

### テスト組織パターン
**タスク**: クライアントサイドゲームプロジェクトでのテスト組織のベストプラクティスをリサーチ

**決定**: タイプ別 (unit/integration/e2e) に整理し、機能ベースのサブディレクトリを使用
**根拠**: 
- Constitutionのcontext-first設計に従った明確な責任分離
- 反復開発サイクル中のフォーカスされたテストを可能に
- libs/features/構造を持つプロジェクトのモジュラーアーキテクチャをサポート

**検討した代替案**:
- ソースとコロケートされたテストファイル: src/ディレクトリを乱雑にし、分離に違反
- フラットなテスト構造: 成長するテストスイートでスケーラビリティが低い

### パフォーマンステスト統合
**タスク**: 60 FPS要件とのパフォーマンステスト統合をリサーチ

**決定**: 統合テストに基本的なパフォーマンスアサーションを含める
**根拠**: 
- Constitutionで60 FPSターゲットを指定しているため、テストはパフォーマンス制約を検証すべき
- 統合テストはコンポーネントレンダリングパフォーマンスを測定可能
- Playwrightはページロードとインタラクションパフォーマンスを測定可能

**検討した代替案**:
- 別個のパフォーマンステストスイート: 明確な利点なしに複雑さを追加
- 手動パフォーマンス監視: 自動テストより信頼性が低い

## 解決された明確化

- **テストフレームワーク**: Constitutionに従いJest + Playwrightを確認
- **エラーバウンダリ**: Astro互換性のためのReactベースコンポーネント
- **テスト構造**: tests/ディレクトリ with unit/, integration/, e2e/サブディレクトリ
- **パフォーマンス**: 既存のテストタイプに統合された基本的なパフォーマンスチェック

## 未解決の質問

なし - すべての技術的不明点がリサーチを通じて解決されました。